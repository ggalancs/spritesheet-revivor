!function(){"use strict";function o(t){this.rect=t}function I(t,a,r,i,o){this.imageData=t,this.startX=a,this.startY=r,this.width=i,this.height=o}I.prototype={isSamePixelColor:function(t,a,r){var i=4*(this.imageData.width*(this.startY+r)+this.startX+a),o=this.imageData.data;return o[i]==t[0]&&o[1+i]==t[1]&&o[2+i]==t[2]&&o[3+i]==t[3]}};function r(t,a){this.abort=!1,this.imageData=t,this.backgroundColor=a}r.prototype={process:function(t){this.rects=[],this.results=[],this.onComplete=t;for(var a=0,r=this.imageData.height;a<r;)for(var i=a++,o=0,e=this.imageData.width;o<e;){var s=o++;this.processFrom(s,i)}this.end()},cancel:function(){this.abort=!0},end:function(){for(var t=0,a=this.rects;t<a.length;){var r=a[t];++t;var i=new o(r);this.results.push(i)}this.onComplete(this.results)},processFrom:function(t,a){var r=0,i=new E(t,a,2,2);if(!this.overlap(i))for(;r<100;){for(var o=i.width,e=i.height,s=new I(this.imageData,i.left,i.top,o,e),n=!0,h=0,u=o;h<u;){var g=h++,c=this.backgroundColor,l=4*(s.imageData.width*s.startY+s.startX+g),d=s.imageData.data;if(d[l]!=c[0]||d[1+l]!=c[1]||d[2+l]!=c[2]||d[3+l]!=c[3]){i.top--,i.height++,n=!1;break}}for(var f=0,_=o;f<_;){var m=f++,p=this.backgroundColor,v=4*(s.imageData.width*(s.startY+(e-1))+s.startX+m),w=s.imageData.data;if(w[v]!=p[0]||w[1+v]!=p[1]||w[2+v]!=p[2]||w[3+v]!=p[3]){i.height++,n=!1;break}}for(var b=0,k=e;b<k;){var D=b++,C=this.backgroundColor,X=4*(s.imageData.width*(s.startY+D)+s.startX),Y=s.imageData.data;if(Y[X]!=C[0]||Y[1+X]!=C[1]||Y[2+X]!=C[2]||Y[3+X]!=C[3]){i.left--,i.width++,n=!1;break}}for(var x=0,y=e;x<y;){var B=x++,F=this.backgroundColor,S=4*(s.imageData.width*(s.startY+B)+s.startX+(o-1)),M=s.imageData.data;if(M[S]!=F[0]||M[1+S]!=F[1]||M[2+S]!=F[2]||M[3+S]!=F[3]){i.width++,n=!1;break}}if(++r,n)return this.overlap(i)?void 0:this.isFullBackground(s)?void 0:void this.rects.push(i)}},isBackground:function(t,a){return t[a]==this.backgroundColor[0]&&t[a+1]==this.backgroundColor[1]&&t[a+2]==this.backgroundColor[2]&&t[a+3]==this.backgroundColor[3]},isFullBackground:function(t){for(var a=0,r=t.height;a<r;)for(var i=a++,o=0,e=t.width;o<e;){var s=o++,n=this.backgroundColor,h=4*(t.imageData.width*(t.startY+i)+t.startX+s),u=t.imageData.data;if(u[h]!=n[0]||u[1+h]!=n[1]||u[2+h]!=n[2]||u[3+h]!=n[3])return!1}return!0},overlap:function(t){for(var a=0,r=this.rects;a<r.length;){var i=r[a];if(++a,!(t.left>i.get_right()||i.left>t.get_right()||t.top>i.get_bottom()||i.top>t.get_bottom()))return!0}return!1},debugDraw:function(t,a,r){window.document.getElementById("debug").getContext("2d",null).putImageData(t,a,r)}};var E=function(t,a,r,i){this.left=t,this.top=a,this.width=r,this.height=i};E.prototype={get_right:function(){return this.left+this.width},get_bottom:function(){return this.top+this.height}};function t(){this.workerScope=self,this.workerScope.onmessage=function(t,a){if(null==a)return null;null==a.__id__&&(a.__id__=i++);var r;null==t.hx__closures__?t.hx__closures__={}:r=t.hx__closures__[a.__id__];null==r&&((r=function(){return r.method.apply(r.scope,arguments)}).scope=t,r.method=a,t.hx__closures__[a.__id__]=r);return r}(this,this.onMessage)}t.main=function(){new t},t.prototype={onMessage:function(t){var a=this;console.log("worker received: "),console.log(t.data),new r(t.data.imageData,t.data.backgroundColor).process(function(t){a.workerScope.postMessage(t)})}};var i=0;t.main()}();
