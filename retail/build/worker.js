!function(){"use strict";function o(t){this.rect=t}function I(t,a,i,r,o){this.imageData=t,this.startX=a,this.startY=i,this.width=r,this.height=o}I.prototype={isSamePixelColor:function(t,a,i){var r=4*(this.imageData.width*(this.startY+i)+this.startX+a),o=this.imageData.data;return o[r]==t[0]&&o[1+r]==t[1]&&o[2+r]==t[2]&&o[3+r]==t[3]}};function i(t,a){this.abort=!1,this.imageData=t,this.backgroundColor=a}i.prototype={process:function(t){this.rects=[],this.results=[],this.onComplete=t;for(var a=0,i=this.imageData.height;a<i;)for(var r=a++,o=0,e=this.imageData.width;o<e;){var s=o++;this.processFrom(s,r)}this.end()},cancel:function(){this.abort=!0},end:function(){for(var t=0,a=this.rects;t<a.length;){var i=a[t];++t;var r=new o(i);this.results.push(r)}this.onComplete(this.results)},processFrom:function(t,a){var i=0,r=new E(t,a,2,2);if(!this.overlap(r))for(;i<100;){for(var o=r.width,e=r.height,s=new I(this.imageData,r.left,r.top,o,e),h=!0,n=0,u=o;n<u;){var c=n++,g=this.backgroundColor,d=4*(s.imageData.width*s.startY+s.startX+c),l=s.imageData.data;if(l[d]!=g[0]||l[1+d]!=g[1]||l[2+d]!=g[2]||l[3+d]!=g[3]){r.top--,r.height++,h=!1;break}}for(var f=0,p=o;f<p;){var _=f++,m=this.backgroundColor,v=4*(s.imageData.width*(s.startY+(e-1))+s.startX+_),w=s.imageData.data;if(w[v]!=m[0]||w[1+v]!=m[1]||w[2+v]!=m[2]||w[3+v]!=m[3]){r.height++,h=!1;break}}for(var k=0,b=e;k<b;){var D=k++,C=this.backgroundColor,X=4*(s.imageData.width*(s.startY+D)+s.startX),Y=s.imageData.data;if(Y[X]!=C[0]||Y[1+X]!=C[1]||Y[2+X]!=C[2]||Y[3+X]!=C[3]){r.left--,r.width++,h=!1;break}}for(var x=0,y=e;x<y;){var B=x++,F=this.backgroundColor,S=4*(s.imageData.width*(s.startY+B)+s.startX+(o-1)),M=s.imageData.data;if(M[S]!=F[0]||M[1+S]!=F[1]||M[2+S]!=F[2]||M[3+S]!=F[3]){r.width++,h=!1;break}}if(++i,h)return this.overlap(r)?void 0:this.isFullBackground(s)?void 0:void this.rects.push(r)}},isBackground:function(t,a){return t[a]==this.backgroundColor[0]&&t[a+1]==this.backgroundColor[1]&&t[a+2]==this.backgroundColor[2]&&t[a+3]==this.backgroundColor[3]},isFullBackground:function(t){for(var a=0,i=t.height;a<i;)for(var r=a++,o=0,e=t.width;o<e;){var s=o++,h=this.backgroundColor,n=4*(t.imageData.width*(t.startY+r)+t.startX+s),u=t.imageData.data;if(u[n]!=h[0]||u[1+n]!=h[1]||u[2+n]!=h[2]||u[3+n]!=h[3])return!1}return!0},overlap:function(t){for(var a=0,i=this.rects;a<i.length;){var r=i[a];if(++a,!(t.left>r.left+r.width||r.left>t.left+t.width||t.top>r.top+r.height||r.top>t.top+t.height))return!0}return!1},debugDraw:function(t,a,i){window.document.getElementById("debug").getContext("2d",null).putImageData(t,a,i)}};var E=function(t,a,i,r){this.left=t,this.top=a,this.width=i,this.height=r};E.prototype={get_right:function(){return this.left+this.width},get_bottom:function(){return this.top+this.height}};function t(){this.workerScope=self,this.workerScope.onmessage=function(t,a){if(null==a)return null;null==a.__id__&&(a.__id__=r++);var i;null==t.hx__closures__?t.hx__closures__={}:i=t.hx__closures__[a.__id__];null==i&&((i=function(){return i.method.apply(i.scope,arguments)}).scope=t,i.method=a,t.hx__closures__[a.__id__]=i);return i}(this,this.onMessage)}t.main=function(){new t},t.prototype={onMessage:function(t){var a=this;new i(t.data.imageData,t.data.backgroundColor).process(function(t){a.workerScope.postMessage(t)})}};var r=0;t.main()}();
